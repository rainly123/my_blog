---
title: "关于golang框架搭建和开发规范的思考"
date: 2021-04-11T17:04:00+08:00
description: java，golang工程师，项目管理，软件架构
draft: true
toc: true
---

2021年4月11日

**注：这篇文章可能没什么深度，但是无论对于开发者还是管理者都是非常非常重要的事情**

## 一直以来的困扰

“改编不是乱编，戏说不是胡说”，对于开发语言来讲，“灵活不是说你可以乱搞”。 接触golang其实有些年头了，真正做golang开发也有两年多，在这之前做过写过PHP，.net和java，有一个深刻的感触，当初讨厌java就是觉得这玩意儿条条框框太多，太死板，但是随着工作经验的积累，待过大大小小的团队，做过普通开发，也做过小管理，最后终于体会到，年少不知java香，错把php连夜刚，年少不知java好，错把golang当成宝。离开了java也就基本上离开了设计模式，很多其他语言的设计思路和设计模式都是在模仿java，尤其像php和golang这种非常灵活的语言，团队内开发人员的能力层次不齐，如果不制定好严格统一的标准，那代码质量是很难把控的。比如说很多php程序员经常会在某mvc框架中的controller层把一切的事儿都干了，model层基本上就成了摆件；再比如很多golang程序员或多或少接触过一些java，于是在框架设计的时候模仿了一些java的影子，框架中设计了dao层和service层，但是很多同学在实际开发中就会在dao层处理业务逻辑，还有些同学直接在service层访问数据，另后来维护的人十分头疼，除此之外，struct满天飞，orm的和业务的混在一起…其实每门语言有每一门语言的优势，在一个团队当中，只要框架设计合理，制定统一的标准并严格执行，代码质量还是可控的。

## 基本三大件

- 路由层，你可以把他命名为route，handler，http(也勉强说得过去)，这个层只提供对外访问的访问入口，其它一切参数校验的逻辑放在这都是不合理的。
- controller层，几乎在百分之90以上的mvc框架中都是必须有的，也是最重要的一层，但是很多golang的开发人员经常把这层省了，尤其是用gin框架的同学，经常把controller做的事情放到了路由层，个人觉得是极其不合理的设计。
- service层，如前文所说，很多做PHP的同学经常直接在controller层干了所有的事情，导致controller十分臃肿，代码的层次不清晰，其实service层还可再拆分成model层和dao层，如果你嫌麻烦，觉得项目不大，直接在service层做掉数据访问，逻辑处理也是可以的。
- 但是我建议你不要在service层里面把业务逻辑，缓存，数据访问，orm管理全做了，**你至少至少至少都要把model层拆分出来，因为基于golang的项目，你写着写着就会发现struct满天飞了**，所以将DB或ES的映射关系的struct单独拿出来维护很有必要，不要高估你的眼力，当代码越来越臃肿的时候，每当更改了一个映射关系的时候，你修改起来就会很费劲。

## models和dao层

正如前文所说，models单独维护是非常有必要的，拆的再细分一点，基于业务的struct和基于db映关系的struct区别对待，拆分管理在日趋庞大的系统中很有必要。我们为什么把数据访问——DAO层单独拿出来，当然是为了结构清晰，当数据访问出了问题，你立马就会定位到dao层，而不需要在臃肿的service里面去翻代码，对于后期维护来说，会更加的轻松。

## common

通常我们在做一个项目的时候，不仅仅要考虑到当前的项目，大多数时候，一个web项目分为前后台，有时候很多的方法和数据访问是相同的，有很多的同学认为，对于这种场景，应该把前后端通用的逻辑放到common中，其实这是一种非常危险的行为。因为，通常情况下，后台的需求都是公司内部人员使用，或者说使用面积不会像前台那么广，有时候可能因为一些后台的业务需求变动，改变了这部分通用的需求，导致前台出了问题。这其实是一个代码复用性和解藕的矛盾，但是在这种情况下，为了项目的稳定，我们只能选择牺牲代码的复用性，因此common里面不适合放多个模块通用的业务逻辑处理。那common的作用也就一目了然了，他只适合提供通用的工具，如类型转换，上传，算法等等。

## uber规范

对具体的针对golang语言方面的规范，可以参照uber https://github.com/xxjwxc/uber_go_guide_cn